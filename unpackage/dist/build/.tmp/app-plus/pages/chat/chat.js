(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/chat/chat"],{"1d28":function(e,t,a){"use strict";a.r(t);var o=a("4034"),n=a.n(o);for(var i in o)"default"!==i&&function(e){a.d(t,e,function(){return o[e]})}(i);t["default"]=n.a},4034:function(t,a,o){"use strict";(function(t,n){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;s(o("3137"));var i=s(o("cf5f"));function s(e){return e&&e.__esModule?e:{default:e}}var c,r,u,l,p=function(){return Promise.all([o.e("common/vendor"),o.e("components/chatmsg")]).then(o.bind(null,"f0d0"))},d=Date.parse(new Date),f="",h=!1,g=0,m=!1,v={duration:1e4,sampleRate:44100,numberOfChannels:1,encodeBitRate:192e3,format:"mp3",frameSize:50},T={components:{chatMsg:p},data:function(){return{per_page:0,list:[],content:"",wsConn:!1,group:{},user:{},toUser:{},emoList:[],sch:0,oldsch:0,scrollTop:1e4,emoClass:"",aRecordClass:"",aRecordIng:!1,time:0}},onPageScroll:function(e){0!=e.scrollTop||m||(this.getList(),m=!0,setTimeout(function(){m=!1},2e3))},onLoad:function(a){var o=t.getSystemInfoSync();g=o.windowHeight;var s=this;this.emoList=i.default.emoList(),r=a.groupid,this.getPage(),l=wx.getRecorderManager(),l.onStop(function(e){e.tempFilePath&&s.recordUpload(e.tempFilePath)}),l.onError(function(t){console.log(n(e," at pages\\chat\\chat.vue:157"))})},onHide:function(){if(h)return!1;u.close({success:function(e){}})},onShow:function(){if(h)return!1;var e=this;this.wsConn&&e.wsInit()},methods:{scrollY:function(e){this.sch=e.detail.scrollHeight},scTop:function(e){0==this.oldsch&&(this.oldsch=this.sch);var t=this;t.scrollTop=0,this.getList()},getList:function(){this.time=Date.parse(new Date)/1e3;var e=this;if(0==this.per_page)return!1;e.app.get({url:e.app.apiHost+"/module.php?m=im_group&a=home&ajax=1&groupid="+r,data:{per_page:e.per_page},success:function(a){e.per_page=a.data.per_page;var o=e.list;for(var n in a.data.list)o.unshift(a.data.list[n]);e.list=o,setTimeout(function(){e.scrollTop+=10},100),setTimeout(function(){var a=t.createSelectorQuery().in(e);a.select("#main").boundingClientRect(function(a){if(0==e.oldsch)t.pageScrollTo({scrollTop:1e5,duration:1});else{var o=a.height-e.oldsch-g+160;t.pageScrollTo({scrollTop:o,duration:1})}e.oldsch=a.height}).exec()},10)}})},getPage:function(){var e=this;e.app.get({url:e.app.apiHost+"/module.php?m=im_group&a=home&ajax=1&groupid="+r,success:function(a){c=a.data.ws_gid,e.per_page=a.data.per_page,e.group=a.data.group,e.user=a.data.user,t.setNavigationBarTitle({title:a.data.group.title}),e.list=a.data.list,e.wsInit(),setTimeout(function(){e.wsConn=!0},1e3);setTimeout(function(){var a=t.createSelectorQuery().in(e);a.select("#main").boundingClientRect(function(t){e.oldsch=t.height}).exec(),t.pageScrollTo({scrollTop:e.scrollTop+10,duration:1})},30)}})},wsInit:function(){var e=this;this.wsConn&&u.close(),u=t.connectSocket({url:e.app.wsHost,complete:function(e){}}),u.onOpen(function(t){var a=JSON.stringify({type:"login",k:d,gid:c,appGroupId:e.group.groupid,content:"login"});u.send({data:a})}),u.onError(function(e){}),u.onMessage(function(a){var o=JSON.parse(a.data);switch(console.log(n(o," at pages\\chat\\chat.vue:303")),o.type){case"login":break;case"say":var i={gid:c,imgurl:e.group.imgurl,appGroupId:e.group.groupid,appGroupTitle:e.group.title,uid:o.wsclient_from,touid:o.wsclient_to,content:o.content,time:o.time,isme:d==o.wsclient_from};e.addMsg(i),setTimeout(function(){t.pageScrollTo({scrollTop:1e6})},100);break}})},addMsg:function(e){var t=this.list;t.push(e),this.list=t},addEmo:function(e){e="\\"+e+" ",this.content+=e},send:function(e,t){var a,o=this;switch(e){case"pic":a="[img="+t+"]";break;case"audio":a="[audio="+t+"]";break;case"video":a="[video="+t+"]";break;case"file":a=t.substring(t.lastIndexOf("/")+1)+" [file="+t+"]";break;case"content":if(a=o.content,""==a)return!1;break}var i=JSON.stringify({wsclient_to:f,type:"say",gid:c,content:a,user_head:o.user.user_head,nickname:o.user.nickname,userid:o.user.userid});console.log(n(a," at pages\\chat\\chat.vue:373")),i,u.send({data:i}),o.saveHost(a),o.content=""},saveHost:function(e){var t=this;t.app.post({url:t.app.apiHost+"/module.php?m=im_group_msg&a=save",data:{groupid:t.group.groupid,content:e},success:function(e){console.log(n(e," at pages\\chat\\chat.vue:391"))}})},choiceImg:function(){var e=this;h=!0,t.chooseImage({sourceType:["album"],fail:function(e){h=!1},success:function(a){h=!1,t.uploadFile({url:e.app.apiHost+"/index.php?m=upload&a=img&ajax=1&authcode="+e.app.getAuthCode(),filePath:a.tempFilePaths[0],name:"upimg",dataType:"json",success:function(t){if(!t.data.error){var a=JSON.parse(t.data);a.error||e.send("pic",a.data.trueimgurl)}}})}})},choiceFile:function(){var e=this;h=!0,t.chooseImage({fail:function(e){h=!1},success:function(a){h=!1,t.uploadFile({url:e.app.apiHost+"/index.php?m=upload&a=upload&ajax=1&authcode="+e.app.getAuthCode(),filePath:a.tempFilePaths[0],name:"upimg",dataType:"json",success:function(t){if(!t.error){var a=JSON.parse(t.data);a.error||e.send("file",a.trueimgurl)}}})}})},catchImg:function(){var e=this;h=!0,t.chooseImage({fail:function(e){h=!1},sourceType:["camera"],success:function(a){h=!1,t.uploadFile({url:e.app.apiHost+"/index.php?m=upload&a=img&ajax=1&authcode="+e.app.getAuthCode(),filePath:a.tempFilePaths[0],name:"upimg",dataType:"json",success:function(t){if(!t.data.error){var a=JSON.parse(t.data);a.data.error||e.send("pic",a.data.trueimgurl)}}})}})},videoRecord:function(){var e=this;t.chooseVideo({count:1,success:function(a){t.uploadFile({url:e.app.apiHost+"/index.php?m=upload&a=uploadmp4&ajax=1&authcode="+e.app.getAuthCode(),filePath:a.tempFilePath,name:"upimg",dataType:"json",success:function(t){if(!t.data.error){var a=JSON.parse(t.data);a.error||e.send("video",a.trueimgurl)}}})}})},recordUpload:function(e){var a=this;console.log(n(e," at pages\\chat\\chat.vue:506")),t.uploadFile({url:a.app.apiHost+"/index.php?m=upload&a=uploadmp4&ajax=1&authcode="+a.app.getAuthCode(),filePath:e,fileType:"audio",name:"upimg",dataType:"json",success:function(e){if(!e.data.error){var t=JSON.parse(e.data);t.error||a.send("audio",t.trueimgurl)}}})},aRecordToggle:function(){this.aRecordIng?(console.log(n("stop"," at pages\\chat\\chat.vue:526")),l.stop(),this.aRecordIng=!1):(this.aRecordIng=!0,l.start(v))}}};a.default=T}).call(this,o("6e42")["default"],o("0de9")["default"])},"7f34":function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.aRecordClass="flex-col"},e.e1=function(t){e.emoClass="flex-col"},e.e2=function(t){e.emoClass=""},e.e3=function(t){e.aRecordClass=""})},n=[];a.d(t,"a",function(){return o}),a.d(t,"b",function(){return n})},b8e3:function(e,t,a){},c31f:function(e,t,a){"use strict";(function(e){a("b554"),a("921b");o(a("66fd"));var t=o(a("c3c9"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},c3c9:function(e,t,a){"use strict";a.r(t);var o=a("7f34"),n=a("1d28");for(var i in n)"default"!==i&&function(e){a.d(t,e,function(){return n[e]})}(i);a("d4a0");var s=a("2877"),c=Object(s["a"])(n["default"],o["a"],o["b"],!1,null,null,null);t["default"]=c.exports},d4a0:function(e,t,a){"use strict";var o=a("b8e3"),n=a.n(o);n.a}},[["c31f","common/runtime","common/vendor"]]]);