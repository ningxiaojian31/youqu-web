(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/publish"],{"166d":function(t,e,a){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=u(a("a34a")),o=(u(a("e0c9")),u(a("769f")));a("2787");function u(t){return t&&t.__esModule?t:{default:t}}function s(t,e,a,n,i,o,u){try{var s=t[o](u),c=s.value}catch(r){return void a(r)}s.done?e(c):Promise.resolve(c).then(n,i)}function c(t){return function(){var e=this,a=arguments;return new Promise(function(n,i){var o=t.apply(e,a);function u(t){s(o,n,i,u,c,"next",t)}function c(t){s(o,n,i,u,c,"throw",t)}u(void 0)})}}var r={name:"publish",component:{common:o.default},data:function(){return{sign:1,userId:0,content:"",imagePath:[],videoPath:"",isPublish:!1,topics:["话题1"],topicsId:[],pickIndex:0}},onLoad:function(){var e=this;t.getStorage({key:"user",success:function(t){e.userId=t.data.id}}),this.getTopicList()},methods:{getTopicList:function(){var t=this,e={},a=o.default.apiHost+"/invitation/tTopic/list",i="POST";o.default.request(a,e,i).then(function(e){if(n("log",e.data.data," at pages\\index\\publish.vue:91"),1==e.data.code){t.topics=[];for(var a=e.data.data.records,i=0;i<a.length;i++)t.topics.push(a[i].topName),t.topicsId.push(a[i].id)}}).catch(function(t){n("log","出现异常了"," at pages\\index\\publish.vue:102")})},radioChange:function(t){this.sign=t.detail.value},bindPickerChange:function(t){this.pickIndex=t.target.value},textareaAInput:function(t){this.content=t.detail.value},PublishContent:function(){var e={invContent:this.content,invType:this.sign,userId:this.userId,invImage:this.imagePath.toString(),invVideo:this.videoPath,topId:this.topicsId[this.pickIndex]},a=o.default.apiHost+"/invitation/tInvitation/save",n="POST";o.default.request(a,e,n).then(function(e){1==e.data.code?(t.switchTab({url:"./index"}),t.showToast({title:"发帖成功！审核时间为10分钟！",duration:2e3})):t.showToast({title:e.data.msg,duration:2e3})}).catch(function(e){t.showToast({title:"发帖失败...稍后再试",duration:2e3})})},imageClick:function(){var e=c(i.default.mark(function e(){var a;return i.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=this,t.chooseImage({count:3,sizeType:["original","compressed"],sourceType:["album"],success:function(e){if(a.videoPath="",a.imagePath.length+e.tempFilePaths.length>6)return a.$uniToast.warning("最多上传6张图.");var i="",u="";t.getStorage({key:"user",success:function(t){u=t.data.token}});for(var s=0;s<e.tempFilePaths.length;s++)t.uploadFile({url:o.default.apiHost+"/other/qiniu/file/upload",filePath:e.tempFilePaths[s],header:{"Content-Type":"multipart/form-data",token:u},name:"file",formData:{file:"file"},success:function(e){n("log","上传"," at pages\\index\\publish.vue:234"),405===e.statusCode&&(n("log","未登陆"," at pages\\index\\publish.vue:236"),t.navigateTo({url:"/pages/shilu-login/login"}));var o=JSON.parse(e.data);1===o.code&&(i=o.data,a.imagePath=a.imagePath.concat(i),n("log","图片路径：==============="+a.imagePath," at pages\\index\\publish.vue:245"))}})}});case 2:case"end":return e.stop()}},e,this)}));function a(){return e.apply(this,arguments)}return a}(),videoClick:function(){var e=c(i.default.mark(function e(){var a;return i.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=this,t.chooseVideo({count:1,sourceType:["album"],success:function(e){var i="";t.getStorage({key:"user",success:function(t){i=t.data.token}}),t.uploadFile({url:o.default.apiHost+"/other/qiniu/file/upload",filePath:e.tempFilePath,header:{"Content-Type":"multipart/form-data",token:i},name:"file",formData:{file:"file"},success:function(e){n("log","上传"," at pages\\index\\publish.vue:283"),405===e.statusCode&&(n("log","未登陆"," at pages\\index\\publish.vue:285"),t.navigateTo({url:"/pages/shilu-login/login"}));var i=JSON.parse(e.data);1===i.code&&(a.videoPath=i.data,n("log","视频路径：==============="+a.videoPath," at pages\\index\\publish.vue:293"))}})}});case 2:case"end":return e.stop()}},e,this)}));function a(){return e.apply(this,arguments)}return a}()}};e.default=r}).call(this,a("6e42")["default"],a("0de9")["default"])},"6cac":function(t,e,a){"use strict";a.r(e);var n=a("9b53"),i=a("c9a7");for(var o in i)"default"!==o&&function(t){a.d(e,t,function(){return i[t]})}(o);a("7a8f");var u,s=a("f0c5"),c=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"26775780",null,!1,n["a"],u);e["default"]=c.exports},"7a8f":function(t,e,a){"use strict";var n=a("a089"),i=a.n(n);i.a},"9b53":function(t,e,a){"use strict";var n,i=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){return t.imagePath.splice(t.index,1)},t.e1=function(e){t.videoPath=""})},o=[];a.d(e,"b",function(){return i}),a.d(e,"c",function(){return o}),a.d(e,"a",function(){return n})},a089:function(t,e,a){},c449:function(t,e,a){"use strict";(function(t){a("b554"),a("921b");n(a("66fd"));var e=n(a("6cac"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("6e42")["createPage"])},c9a7:function(t,e,a){"use strict";a.r(e);var n=a("166d"),i=a.n(n);for(var o in n)"default"!==o&&function(t){a.d(e,t,function(){return n[t]})}(o);e["default"]=i.a}},[["c449","common/runtime","common/vendor"]]]);